// +build amd64

package domain

import (
	"strings"
	"testing"
)

var strs64 = []testLabelPair{
	testLabelPair{
		s: "0\x00\x00\x00\x00\x00\x00\x00",
		n: 1,
	},
	testLabelPair{
		s: "01\x00\x00\x00\x00\x00\x00",
		n: 2,
	},
	testLabelPair{
		s: "012\x00\x00\x00\x00\x00",
		n: 3,
	},
	testLabelPair{
		s: "0123\x00\x00\x00\x00",
		n: 4,
	},
	testLabelPair{
		s: "01234\x00\x00\x00",
		n: 5,
	},
	testLabelPair{
		s: "012345\x00\x00",
		n: 6,
	},
	testLabelPair{
		s: "0123456\x00",
		n: 7,
	},
	testLabelPair{
		s: "01234567",
		n: 8,
	},
	testLabelPair{
		s: "012345670\x00\x00\x00\x00\x00\x00\x00",
		n: 9,
	},
	testLabelPair{
		s: "0123456701\x00\x00\x00\x00\x00\x00",
		n: 10,
	},
	testLabelPair{
		s: "01234567012\x00\x00\x00\x00\x00",
		n: 11,
	},
	testLabelPair{
		s: "012345670123\x00\x00\x00\x00",
		n: 12,
	},
	testLabelPair{
		s: "0123456701234\x00\x00\x00",
		n: 13,
	},
	testLabelPair{
		s: "01234567012345\x00\x00",
		n: 14,
	},
	testLabelPair{
		s: "012345670123456\x00",
		n: 15,
	},
	testLabelPair{
		s: "0123456701234567",
		n: 16,
	},
	testLabelPair{
		s: "01234567012345670\x00\x00\x00\x00\x00\x00\x00",
		n: 17,
	},
	testLabelPair{
		s: "012345670123456701\x00\x00\x00\x00\x00\x00",
		n: 18,
	},
	testLabelPair{
		s: "0123456701234567012\x00\x00\x00\x00\x00",
		n: 19,
	},
	testLabelPair{
		s: "01234567012345670123\x00\x00\x00\x00",
		n: 20,
	},
	testLabelPair{
		s: "012345670123456701234\x00\x00\x00",
		n: 21,
	},
	testLabelPair{
		s: "0123456701234567012345\x00\x00",
		n: 22,
	},
	testLabelPair{
		s: "01234567012345670123456\x00",
		n: 23,
	},
	testLabelPair{
		s: "012345670123456701234567",
		n: 24,
	},
	testLabelPair{
		s: "0123456701234567012345670\x00\x00\x00\x00\x00\x00\x00",
		n: 25,
	},
	testLabelPair{
		s: "01234567012345670123456701\x00\x00\x00\x00\x00\x00",
		n: 26,
	},
	testLabelPair{
		s: "012345670123456701234567012\x00\x00\x00\x00\x00",
		n: 27,
	},
	testLabelPair{
		s: "0123456701234567012345670123\x00\x00\x00\x00",
		n: 28,
	},
	testLabelPair{
		s: "01234567012345670123456701234\x00\x00\x00",
		n: 29,
	},
	testLabelPair{
		s: "012345670123456701234567012345\x00\x00",
		n: 30,
	},
	testLabelPair{
		s: "0123456701234567012345670123456\x00",
		n: 31,
	},
	testLabelPair{
		s: "01234567012345670123456701234567",
		n: 32,
	},
	testLabelPair{
		s: "012345670123456701234567012345670\x00\x00\x00\x00\x00\x00\x00",
		n: 33,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701\x00\x00\x00\x00\x00\x00",
		n: 34,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012\x00\x00\x00\x00\x00",
		n: 35,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123\x00\x00\x00\x00",
		n: 36,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234\x00\x00\x00",
		n: 37,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345\x00\x00",
		n: 38,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456\x00",
		n: 39,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567",
		n: 40,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670\x00\x00\x00\x00\x00\x00\x00",
		n: 41,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701\x00\x00\x00\x00\x00\x00",
		n: 42,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012\x00\x00\x00\x00\x00",
		n: 43,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123\x00\x00\x00\x00",
		n: 44,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234\x00\x00\x00",
		n: 45,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345\x00\x00",
		n: 46,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456\x00",
		n: 47,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567",
		n: 48,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670\x00\x00\x00\x00\x00\x00\x00",
		n: 49,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701\x00\x00\x00\x00\x00\x00",
		n: 50,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012\x00\x00\x00\x00\x00",
		n: 51,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670123\x00\x00\x00\x00",
		n: 52,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701234\x00\x00\x00",
		n: 53,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012345\x00\x00",
		n: 54,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670123456\x00",
		n: 55,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701234567",
		n: 56,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012345670\x00\x00\x00\x00\x00\x00\x00",
		n: 57,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670123456701\x00\x00\x00\x00\x00\x00",
		n: 58,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701234567012\x00\x00\x00\x00\x00",
		n: 59,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012345670123\x00\x00\x00\x00",
		n: 60,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670123456701234\x00\x00\x00",
		n: 61,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701234567012345\x00\x00",
		n: 62,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012345670123456\x00",
		n: 63,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670123456701234567",
		n: 64,
	},
}

var strs64z = []testLabelPair{
	testLabelPair{
		s: "z\x00\x00\x00\x00\x00\x00\x00",
		n: 1,
	},
	testLabelPair{
		s: "0z\x00\x00\x00\x00\x00\x00",
		n: 2,
	},
	testLabelPair{
		s: "01z\x00\x00\x00\x00\x00",
		n: 3,
	},
	testLabelPair{
		s: "012z\x00\x00\x00\x00",
		n: 4,
	},
	testLabelPair{
		s: "0123z\x00\x00\x00",
		n: 5,
	},
	testLabelPair{
		s: "01234z\x00\x00",
		n: 6,
	},
	testLabelPair{
		s: "012345z\x00",
		n: 7,
	},
	testLabelPair{
		s: "0123456z",
		n: 8,
	},
	testLabelPair{
		s: "01234567z\x00\x00\x00\x00\x00\x00\x00",
		n: 9,
	},
	testLabelPair{
		s: "012345670z\x00\x00\x00\x00\x00\x00",
		n: 10,
	},
	testLabelPair{
		s: "0123456701z\x00\x00\x00\x00\x00",
		n: 11,
	},
	testLabelPair{
		s: "01234567012z\x00\x00\x00\x00",
		n: 12,
	},
	testLabelPair{
		s: "012345670123z\x00\x00\x00",
		n: 13,
	},
	testLabelPair{
		s: "0123456701234z\x00\x00",
		n: 14,
	},
	testLabelPair{
		s: "01234567012345z\x00",
		n: 15,
	},
	testLabelPair{
		s: "012345670123456z",
		n: 16,
	},
	testLabelPair{
		s: "0123456701234567z\x00\x00\x00\x00\x00\x00\x00",
		n: 17,
	},
	testLabelPair{
		s: "01234567012345670z\x00\x00\x00\x00\x00\x00",
		n: 18,
	},
	testLabelPair{
		s: "012345670123456701z\x00\x00\x00\x00\x00",
		n: 19,
	},
	testLabelPair{
		s: "0123456701234567012z\x00\x00\x00\x00",
		n: 20,
	},
	testLabelPair{
		s: "01234567012345670123z\x00\x00\x00",
		n: 21,
	},
	testLabelPair{
		s: "012345670123456701234z\x00\x00",
		n: 22,
	},
	testLabelPair{
		s: "0123456701234567012345z\x00",
		n: 23,
	},
	testLabelPair{
		s: "01234567012345670123456z",
		n: 24,
	},
	testLabelPair{
		s: "012345670123456701234567z\x00\x00\x00\x00\x00\x00\x00",
		n: 25,
	},
	testLabelPair{
		s: "0123456701234567012345670z\x00\x00\x00\x00\x00\x00",
		n: 26,
	},
	testLabelPair{
		s: "01234567012345670123456701z\x00\x00\x00\x00\x00",
		n: 27,
	},
	testLabelPair{
		s: "012345670123456701234567012z\x00\x00\x00\x00",
		n: 28,
	},
	testLabelPair{
		s: "0123456701234567012345670123z\x00\x00\x00",
		n: 29,
	},
	testLabelPair{
		s: "01234567012345670123456701234z\x00\x00",
		n: 30,
	},
	testLabelPair{
		s: "012345670123456701234567012345z\x00",
		n: 31,
	},
	testLabelPair{
		s: "0123456701234567012345670123456z",
		n: 32,
	},
	testLabelPair{
		s: "01234567012345670123456701234567z\x00\x00\x00\x00\x00\x00\x00",
		n: 33,
	},
	testLabelPair{
		s: "012345670123456701234567012345670z\x00\x00\x00\x00\x00\x00",
		n: 34,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701z\x00\x00\x00\x00\x00",
		n: 35,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012z\x00\x00\x00\x00",
		n: 36,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123z\x00\x00\x00",
		n: 37,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234z\x00\x00",
		n: 38,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345z\x00",
		n: 39,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456z",
		n: 40,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567z\x00\x00\x00\x00\x00\x00\x00",
		n: 41,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670z\x00\x00\x00\x00\x00\x00",
		n: 42,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701z\x00\x00\x00\x00\x00",
		n: 43,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012z\x00\x00\x00\x00",
		n: 44,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123z\x00\x00\x00",
		n: 45,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234z\x00\x00",
		n: 46,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345z\x00",
		n: 47,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456z",
		n: 48,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567z\x00\x00\x00\x00\x00\x00\x00",
		n: 49,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670z\x00\x00\x00\x00\x00\x00",
		n: 50,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701z\x00\x00\x00\x00\x00",
		n: 51,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012z\x00\x00\x00\x00",
		n: 52,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670123z\x00\x00\x00",
		n: 53,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701234z\x00\x00",
		n: 54,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012345z\x00",
		n: 55,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670123456z",
		n: 56,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701234567z\x00\x00\x00\x00\x00\x00\x00",
		n: 57,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012345670z\x00\x00\x00\x00\x00\x00",
		n: 58,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670123456701z\x00\x00\x00\x00\x00",
		n: 59,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701234567012z\x00\x00\x00\x00",
		n: 60,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012345670123z\x00\x00\x00",
		n: 61,
	},
	testLabelPair{
		s: "0123456701234567012345670123456701234567012345670123456701234z\x00\x00",
		n: 62,
	},
	testLabelPair{
		s: "01234567012345670123456701234567012345670123456701234567012345z\x00",
		n: 63,
	},
	testLabelPair{
		s: "012345670123456701234567012345670123456701234567012345670123456z",
		n: 64,
	},
}

func BenchmarkDomainComparisonWithAmd64Compare(b *testing.B) {
	for n := 0; n < b.N; n++ {
		i := n & 1023
		name := names[i]
		seq := labels[i]

		j := 0
		if err := name.GetLabels(func(s string, n int) error {
			sl := seq[j]
			if n == sl.n && Compare(s, sl.s) == 0 {
				j++
				return nil
			}

			return errStop
		}); err != nil {
			b.Fatalf("not equal for %q at %d (%d:%d)", name, n, i, j)
		}
	}
}

func BenchmarkDomainCompareFuncAmd64(b *testing.B) {
	for i := 0; i < b.N; i++ {
		n := i & 63
		x := strs64[n]
		y := strs64z[n]
		if x.n == y.n && Compare(x.s, y.s) == 0 {
			b.Fatalf("expected %q to be not equal to %q (%d:%d)", x, y, n, i)
		}
	}
}

func BenchmarkDomainCompareFuncStrings(b *testing.B) {
	for i := 0; i < b.N; i++ {
		n := i & 63
		x := strs64[n]
		y := strs64z[n]
		if x.n == y.n && strings.Compare(x.s, y.s) == 0 {
			b.Fatalf("expected %q to be not equal to %q (%d:%d)", x, y, n, i)
		}
	}
}
